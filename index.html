<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Suivi Travaux 63B</title>
    <link rel="stylesheet" href="./style.css?v=20260116-5" />
  </head>
  <body>
    <header class="header">
      <div class="container">
        <div class="header-top">
          <div>
            <h1>Suivi Travaux 63B</h1>
            <p class="subtitle">
              Liste d'achats matériaux (reste à acheter) — prix TTC, budget fixe (économies).
              Ajuster uniquement si un poste dépasse.
            </p>
          </div>
          <div class="header-actions">
            <button id="exportBtn" class="btn">Exporter commentaires</button>
            <label class="btn btn-secondary file-btn">
              Importer commentaires
              <input id="importInput" type="file" accept="application/json" />
            </label>
            <button id="shareBtn" class="btn btn-secondary">Générer lien à partager</button>
            <button id="clearBtn" class="btn btn-danger">Réinitialiser</button>
          </div>
        </div>

        <div class="tabs" role="tablist" aria-label="Navigation">
          <button class="tab active" type="button" data-view="achats">Achats (appartement)</button>
          <button class="tab" type="button" data-view="bought">2) Déjà acheté (communs + toiture)</button>
          <button class="tab" type="button" data-view="planning">Planning</button>
        </div>

        <div class="controls">
          <div class="control">
            <label for="lotFilter">Lot</label>
            <select id="lotFilter"></select>
          </div>
          <div class="control">
            <label for="roomFilter">Pièce</label>
            <select id="roomFilter"></select>
          </div>
          <div class="control">
            <label for="searchInput">Recherche</label>
            <input id="searchInput" type="search" placeholder="Article, spécification…" />
          </div>
          <div class="control">
            <label for="statusFilter">Statut</label>
            <select id="statusFilter">
              <option value="ALL">Tous</option>
              <option value="bought">Acheté</option>
              <option value="todo">À acheter</option>
            </select>
          </div>
        </div>

        <div class="summary">
          <div class="card">
            <div class="card-title">Budget (fixe)</div>
            <div id="budgetTotal" class="card-value">—</div>
          </div>
          <div class="card">
            <div class="card-title">Réel (avec ajustements)</div>
            <div id="actualTotal" class="card-value">—</div>
            <div id="deltaTotal" class="card-sub">—</div>
          </div>
          <div class="card">
            <div class="card-title">Lignes</div>
            <div id="lineCount" class="card-value">—</div>
            <div id="lineCount2" class="card-sub">—</div>
          </div>
          <div class="card card-wide">
            <div class="card-title">Avancement achats</div>
            <div class="chart-row">
              <div class="chart-wrap">
                <canvas id="buyPie" width="180" height="180" aria-label="Graphique achats" role="img"></canvas>
              </div>
              <div class="chart-legend">
                <div class="legend-item">
                  <span class="legend-swatch swatch-bought"></span>
                  <div>
                    <div class="legend-title">Acheté</div>
                    <div id="legendBought" class="legend-sub">—</div>
                  </div>
                </div>
                <div class="legend-item">
                  <span class="legend-swatch swatch-remaining"></span>
                  <div>
                    <div class="legend-title">Reste à acheter</div>
                    <div id="legendRemaining" class="legend-sub">—</div>
                  </div>
                </div>
                <div id="legendFoot" class="legend-foot">—</div>
              </div>
            </div>
          </div>
          <div class="card card-wide">
            <div class="card-title">Budget par pièce (synthèse)</div>
            <table class="room-table" aria-label="Budget par pièce">
              <thead>
                <tr>
                  <th>Pièce</th>
                  <th class="num">Budget</th>
                  <th class="num">Réel</th>
                  <th class="num">Δ</th>
                  <th class="num">Lignes</th>
                  <th class="num">Acheté</th>
                </tr>
              </thead>
              <tbody id="roomsTbody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </header>

    <main class="container">
      <section id="view-achats" class="view active">
        <div class="table-wrap">
          <table class="table" id="itemsTable">
            <thead>
              <tr>
                <th>Lot</th>
                <th>Article</th>
                <th>Spécification</th>
                <th class="num">Qté</th>
                <th>Unité</th>
                <th class="num">PU</th>
                <th class="num">Budget (Total)</th>
                <th class="num">Réel (Total)</th>
                <th>Statut</th>
                <th>Commentaire artisan</th>
              </tr>
            </thead>
            <tbody id="itemsTbody"></tbody>
          </table>
        </div>

        <footer class="footer">
          <p>
            Astuce: les commentaires/états sont sauvegardés automatiquement (dans votre navigateur). Utilisez
            “Exporter” pour partager un fichier, ou “Générer lien” pour obtenir une URL partageable.
          </p>
        </footer>
      </section>

      <section id="view-bought" class="view">
        <div class="section-card">
          <h2>2) Ce qui a été acheté (communs + colmatage toiture)</h2>
          <p class="section-sub">
            Deux niveaux: <strong>confirmé</strong> (vu explicitement) et <strong>très probable</strong>
            (car “communs + toiture finis”). Vous pouvez cocher “confirmé” et ajouter un commentaire.
          </p>
          <div id="boughtFeatures"></div>
        </div>
      </section>

      <section id="view-planning" class="view">
        <div class="section-card">
          <h2>Planning (15 janvier → fin juin, 2 mecs)</h2>
          <p class="section-sub">
            Hypothèses: pas de gros imprévu structurel, matos dispo, interventions externes (clim) calées.
          </p>
          <div id="planning"></div>
        </div>
      </section>
    </main>

    <script src="./items.js?v=20260116-5"></script>
    <script src="./app.js?v=20260116-5"></script>
  </body>
</html>

